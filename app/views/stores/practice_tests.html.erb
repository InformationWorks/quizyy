<%= render 'store_header' %>

<div id="content" class="span12">
  <div class="span8">
  	
  	<% @categories_and_topics.each_with_index do |category_or_topic,index| %>
	<% if index == 0 %>
	<section class="category-section first">
	<% else %>
	<section class="category-section">	
	<% end %>
    <h2><%= category_or_topic.name %></h2>
    <a href="#" class="pull-right"><h4>more in <%= category_or_topic.name %></h4></a>
    <hr>
    <!-- show only three per row -->
    <div class="row">
      <% category_or_topic.scoped_practice_quizzes(current_user).order("id ASC").first(3).each do |quiz| %>
      <div class="span2 quiz-tile">
        <img src="http://placehold.it/150x100"/>
        <div class="caption">
          <h3>
              <%= link_to quiz.name, show_practice_test_path(:quiz_slug => quiz.slug) %>
          </h3>
          <p><%= quiz.desc %></p>
          <p><%= (quiz.price == 0) ? "Free" : "\u20B9 " + quiz.price.to_s %></p> 
          
          <% if current_user.has_purchased_quiz?(quiz.id) %>
          	<div>
              <%= button_to( "Purchased" , "#" , :disabled => true ) %>
          	</div>
          <% else %>
              	
          	<div class="actions hide btn-group">
          	   <%= link_to( "Buy"  , cart_items_path(:quiz_id => quiz.id,:back_controller => "checkout",:back_action => "show_cart") ,
  						:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id), :class => "btn btn-primary") %>
            <% cart_item_id = current_user.get_cart_item_id_for_quiz(quiz.id) %>  	
          	<% if cart_item_id != -1 %>
  			    	<%= link_to( cart_item_path(:id => cart_item_id,:back_controller => "stores",:back_action => "practice_tests") ,
  						:method => "delete", :disable_with => 'removing from cart...', :disabled => current_user.has_purchased_quiz?(quiz.id),:class => "btn", :title=>'Remove from Cart') do %>
                        <span class="icon-remove"></span>
                    <%end%>
          	<% else %>
  			    	<%= link_to(cart_items_path(:quiz_id => quiz.id,:back_controller => "stores",:back_action => "practice_tests") ,
  						:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id),:class => "btn add-btn",:title=>'Add to Cart' ) do %>
                        <span class="icon-add"></span>
                    <%end%>
          	<% end %>
            </div>
          <% end %>
        </div>
      </div>
      <% end %>
    </div>
    </section>
    <% end %>
  </div>
  <%= content_tag "div", id: "cart-wrapper",class: "span3 well", data: { cart: @cart.cart_items.to_json(:include => :quiz) } do%>
  <% end %>
</div>
