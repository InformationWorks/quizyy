<div class="span8">

<!-- Full length tests -->
<section class="category-section first">
<% if current_user.purchased_full_quizzes.count != 0 %>
<h2>Full length tests</h2>
<a href="#" class="pull-right"><h4>more</h4></a>
<hr>
<!-- show only three per row -->
    <div class="row">
      <% @full_length_quizzes.first(3).each do |quiz| %>
      <div class="span2 quiz-tile">
        <img src="http://placehold.it/150x100"/>
        <div class="caption">
          <h3><a href="#"><%= quiz.name %></a></h3>
          <p><%= quiz.desc %></p>
          <p><%= (quiz.price == 0) ? "Free" : "\u20B9 " + quiz.price.to_s %></p> 
          <% if current_user.has_purchased_quiz?(quiz.id) %>
          	<div>
              <%= link_to( "Purchased" , "#" , :disabled => true ) %>
          	</div>
          <% else %>
          	<div class="actions hide btn-group">
          	    <%= link_to( "Buy"  , cart_items_path(:quiz_id => quiz.id,:back_controller => "checkout",:back_action => "show_cart") ,
  						:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id),:class=>'btn btn-primary') %>
            
                <% cart_item_id = current_user.get_cart_item_id_for_quiz(quiz.id) %>
          	    <% if cart_item_id != -1 %>
  			    	<%= link_to( cart_item_path(:id => cart_item_id,:back_controller => "stores",:back_action => "timed_tests") ,
  						:method => "delete", :disable_with => 'removing from cart...', :disabled => current_user.has_purchased_quiz?(quiz.id),:class=>'btn',:title=>'Remove from Cart', :id=>'remove-item-btn' ) do %>
                        <span class="icon-remove"></span>
                    <%end%>
          	    <% else %>
  			    	<%= link_to( cart_items_path(:quiz_id => quiz.id,:back_controller => "stores",:back_action => "timed_tests") ,
  						:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id),:class=>'btn',:title=>'Add to Cart',:id=>'add-item-btn' ) do %>
                        <span class="icon-plus"></span>
                    <% end %>
          	    <% end %>
              </div>
          <% end %>
        </div>
      </div>
      <% end %>
    </div>
<% end %>
</section>

<!-- Category & Topic Tests -->
<% @categories_and_topics.each_with_index do |category_or_topic,index| %>
<% if index == 0 && current_user.purchased_full_quizzes.count != 0 %>
<section class="category-section first">
<% else %>
<section class="category-section">	
<% end %>
<h2><%= category_or_topic.name %></h2>
<a href="#" class="pull-right"><h4>more</h4></a>
<hr>
<!-- show only three per row -->
<div class="row">
  <% category_or_topic.scoped_timed_quizzes(current_user).order("id ASC").first(3).each do |quiz| %>
  <div class="span2 quiz-tile">
    <img src="http://placehold.it/150x100"/>
    <div class="caption">
      <h3><a href="#"><%= quiz.name %></a></h3>
      <p><%= quiz.desc %></p>
      <p><%= (quiz.price == 0) ? "Free" : "\u20B9 " + quiz.price.to_s %></p> 
      <% if current_user.has_purchased_quiz?(quiz.id) %>
      	<div>
          <%= button_to( "Purchased" , "#" , :disabled => true ) %>
      	</div>
      <% else %>
      	
      	<div class="actions hide">
      	   <%= button_to( "Buy"  , cart_items_path(:quiz_id => quiz.id,:back_controller => "checkout",:back_action => "show_cart") ,
					:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id) ) %>
      	</div>
        
        <% cart_item_id = current_user.get_cart_item_id_for_quiz(quiz.id) %>  	
      	<% if cart_item_id != -1 %>
      		<div>
		    	<%= button_to( "Remove from cart"  , cart_item_path(:id => cart_item_id,:back_controller => "stores",:back_action => "timed_tests") ,
					:method => "delete", :disable_with => 'removing from cart...', :disabled => current_user.has_purchased_quiz?(quiz.id) ) %>
      		</div>
      	<% else %>
      		<div class="actions hide">
		    	<%= button_to( "Add to cart"  , cart_items_path(:quiz_id => quiz.id,:back_controller => "stores",:back_action => "timed_tests") ,
					:method => "post", :disable_with => 'adding to cart...', :disabled => current_user.has_purchased_quiz?(quiz.id) ) %>
      		</div>
      	<% end %>
      	
      <% end %>
    </div>
  </div>
  <% end %>
</div>
</section>

<% end %>

</div>
