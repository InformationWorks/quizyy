<% content_for :head do %>
    <%= javascript_include_tag "bullet" %>
    <style type="text/css">
    .bullet { font: 10px sans-serif; }
    .bullet .marker { stroke: #000; stroke-width: 2px; }
    .bullet .tick line { stroke: #666; stroke-width: .5px; }
    .bullet .range.s2 { fill: rgba(255, 0, 0, 0.1); }
    .bullet .range.s1 { fill: rgba(255, 187, 0, 0.1); }
    .bullet .range.s0 { fill: rgba(100, 244, 177, 0.1); }
    .bullet .measure.s0 { fill: lightsteelblue; }
    .bullet .measure.s1 { fill: #1055b4; }
    .bullet .title { font-size: 14px; font-weight: bold; }
    .bullet .subtitle { fill: #999; }

    </style>
<% end %>
<h1>ProgressReport#show</h1>
<% @report.each do |name,value| %>
	<h3><%=value[:section_name]%></h3>
    <p><%= value[:correct] %> / <%=  value[:total] %></p>
<% end %>
<script>
    var bullets = [
    <% @report.each do |name,value| %>
        <% percent = ((value[:correct]*100)/20) %>
        {"title":"<%=value[:section_name]%>","ranges":[50,80,100],"measures":[<%= percent %>,100],"markers":[100]},
    <% end %>
    ]
    var margin = {top: 5, right: 40, bottom: 20, left: 120},
            width = 960 - margin.left - margin.right,
            height = 50 - margin.top - margin.bottom;

    var chart = d3.bullet()
            .width(width)
            .height(height);

    var svg = d3.select("body").select("section").selectAll("svg")
            .data(bullets)
            .enter().append("svg")
            .attr("class", "bullet")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
            .call(chart);

    var title = svg.append("g")
            .style("text-anchor", "end")
            .attr("transform", "translate(-6," + height / 2 + ")");

    title.append("text")
            .attr("class", "title")
            .text(function(d) { return d.title; });

    title.append("text")
            .attr("class", "subtitle")
            .attr("dy", "1em")
            .text(function(d) { return d.subtitle; });
</script>
